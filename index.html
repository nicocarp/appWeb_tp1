<!DOCTYPE html>
<html>
<head lang="es">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	
	<script type="text/javascript" src="estaticos/js/jquery.min.js"></script>
	<script src="estaticos/js/qunit.js"></script>
	<link rel="stylesheet" href="estaticos/css/qunit.css">
    <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<script type="text/javascript" src="estaticos/js/materialize.min.js"></script>
	<script src="estaticos/js/utils.js"></script>
	<link type="text/css" rel="stylesheet" href="estaticos/css/materialize.min.css"  media="screen,projection"/>
	<script src="tests.js"></script>
	<script src="Ventas.js"></script>
	<script type="text/javascript" src="estaticos/js/underscore.js"></script>
	
	<title>Productos</title>
</head>
<body>
	<nav class="nav-extended red">
		<div class="nav-wrapper">
			<a href="#!" class="brand-logo"><i class="material-icons">cloud</i>Logo</a>
			<ul class="right hide-on-med-and-down">
				<li><a href="sass.html"><i class="material-icons">search</i></a></li>
				<li><a onclick="Materialize.showStaggeredList('#checkout-div')"><i onclick="checkout()" class="material-icons">shopping_cart</i></a></li>

			</ul>
		</div>
	</nav>

	<div class="section no-pad-bot" id="index-banner">
	    <div class="container">
	      	<br><br>
	      	<h1 class="header center orange-text">Productos</h1>	      	
  		</div>
  	<div class="container">
    <div class="section">
      	<ul id="lista_productos" class="row produktliste">      		
      	</ul>     	
    </div>
  </div>

	<div id="qunit"></div>
  	<div id="qunit-fixture"></div>
</body>
	
</html>

<script id="producto-tpl" type="text/template">	
	<li class="product-grid-layout animated bounceIn item last col s12 m6 l3 product-item-box">
		<div class="card">
			<div class="card-image">
				<img src="{{imagen}}">	
					<span class="card-title"></span>
					<a class="btn-floating halfway-fab waves-effect waves-light red"
						onclick="click_producto({{indice}})"
					>
						<i class="material-icons">add</i>		
					</a>
			</div>
		<div class="card-content">
		<p>{{nombre}}</p><p> {{precio}}</p>		
	</li>
</script>



<script type="text/javascript">
	_.templateSettings = {
	  interpolate: /\{\{(.+?)\}\}/g
	};
	//$("body").html(productoTpl({nombre: "producto1", imagen:"http://www.google.com/"}));
	var carrito, ventas;
		
	function click_producto(i){
		console.log("agegado al carro" + i);
		ventas.agregarAlCarro(i, 1);
	}

	function checkout(){
		console.log(ventas.checkout());
	}

	$(document).ready(function(){
		
		$.getJSON( "datos.json", function(datos) {
			carrito = new Carro();
			ventas = new Ventas(new ProductoFactory(datos.ProductosVentas), carrito);
			$("#lista_productos").html(listProductos(ventas.productos));
		});	

		function listProductos(productos){
			var html_productos = _.reduce(_.map(productos, function(prod){ 
				var productoTpl = _.template($("#producto-tpl").html());
				return productoTpl(prod);
				}), function(acumulador, currentItem){
					return acumulador + currentItem;
			});
			return html_productos;
		}
});
	

</script>
