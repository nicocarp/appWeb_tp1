<!DOCTYPE html>
<html>
<head lang="es">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	
	<script type="text/javascript" src="estaticos/js/jquery.min.js"></script>
	<script src="estaticos/js/qunit.js"></script>
	<link rel="stylesheet" href="estaticos/css/qunit.css">
    <link href="estaticos/css/materialize_icons.css" rel="stylesheet">
	<script type="text/javascript" src="estaticos/js/materialize.min.js"></script>
	<script src="estaticos/js/utils.js"></script>
	<link type="text/css" rel="stylesheet" href="estaticos/css/materialize.min.css"  media="screen,projection"/>
	<script src="tests.js"></script>
	<script src="Ventas.js"></script>
	<script type="text/javascript" src="estaticos/js/underscore.js"></script>
	
	<title>Productos</title>
</head>
<body>

<!-- NAV  -->
<nav class="nav-extended red">
	<div class="nav-wrapper">
		<a href="#!" class="brand-logo"><i class="material-icons">cloud</i>River Plate</a>
		<ul class="right hide-on-med-and-down">
			<li><a href="sass.html"><i class="material-icons">search</i></a></li>
			<li><a id="mostrar_carro" href="#modal1"><i  class="material-icons">shopping_cart</i></a></li>

		</ul>
	</div>
</nav>
<!-- FIN NAV  -->
<!-- CONTENEDOR PRINCIPAL  -->
<div class="section no-pad-bot ">
    <div class=" z-depth-3" >
    	<div class="row">
    		<div class="col s10">
    			<h2 class="header  black-text">Shoping</h2>
    		</div>
    		<div class="col s2">    			
    				<span class="badge red-text text-accent-4 " id="cant_prod_carro">0</span>
    				<a id="mostrar_carro" href="#modal1"><i class="material-icons medium red-text rigth">shopping_cart</i></a>    			
    		</div>
    	</div>
      	
    </div>
  	<div class="">
  	<div class="row">
  		<div class="col s3 z-depth-3">
  			<div class="block-title center">
		        <h4>Shop By</h4>
		    </div>
		    <div class="divider red"></div>
  			<ul class="collapsible" data-collapsible="accordion">
			    <li>
			      <div class="collapsible-header"><i class="material-icons">search</i>Categorias</div>
			      <div class="collapsible-body center">			      	
			      	<p><a class="blue-text" href="">Cat1</a></p>
			      	<p><a class="blue-text" href="">Cat1</a></p>
			      	<p><a class="blue-text" href="">Cat1</a></p>
			      </div>
			    </li>
			    <li>
			      <div class="collapsible-header"><i class="material-icons">place</i>Precio</div>
			      <div class="collapsible-body"><span>Lorem ipsum dolor sit amet.</span></div>
			    </li>
			    <li>
			      <div class="collapsible-header"><i class="material-icons">whatshot</i>En Stock</div>
			      <div class="collapsible-body"><span>Lorem ipsum dolor sit amet.</span></div>
			    </li>

			  </ul>
  		</div>
  		<div class="col s9 z-depth-3" >
  			<!-- > LISTADO DE PRODUCTOS <-->
		  	<div class="block-title center">
		  		<h4 class="header black-text">Mostrando datos</h4>
		    </div>
		    <div class="divider red"></div>
			
			    <div id="_ventas" class="secciones" data-ruta="ventas">
			      	<ul id="productos_ventas" class="row produktliste"></ul>     	
			    </div>
			    <div id="_carro" class="secciones"  data-ruta="carro">
			    	<ul id="productos_carro2" class="row produktliste"></ul>		      	
			    </div>
			
		 	<!-- FIN LISTADO PRODUCTOS  -->
  		</div>
  	</div>	    
  	</div>
</div>
<!-- Fin contenedor principal  -->

	<div id="qunit"></div>
  	<div id="qunit-fixture"></div>
      


  <!-- Modal Structure -->
  <div id="modal1" class="modal modal-fixed-footer">
    <div class="modal-content">
	  <h3 class="header center black-text" >Carrito de Compras</h3>
       <ul class="collection" id="productos_carro"></ul>

    </div>
    <div class="modal-footer">
		<button type="button" title="Proceed to Checkout" class="button waves-effect waves-light btn red accent-4  "><span><span>Proceed to Checkout</span></span></button>
	 </div>
	</div>
</body>
	
</html>

<script id="producto-carro-tpl" type="text/template">
{{ _.each(productos, function(producto){  }}
	<li class="collection-item avatar" id="{{=producto.producto.nombre}}">
        <img src="{{=producto.producto.imagen}}" class="circle">
     	<div class="row">
         	<div class=" col s4">
         		<span class="title">{{=producto.producto.nombre}}</span>         		
         		<p>${{=producto.producto.precio}} c/u</p>
			</div>
			<div class=" col s4">
     			<div class="row">
     				<div class="input-field login-form-text col s6">
        				<input id="cant_carrito" data-id-prod="{{=producto.producto.id}}" maxlength="12" value="{{=producto.cantidad}}" type="number">				
        			</div>
     			</div>
			</div>
			<div class=" col s4">
	        	<span class="title">SubTotal</span>
	        	<p></p>{{=producto.precioSubTotal}}<br>
	        	    <span class="new badge green" data-badge-caption="Stock">0</span>
			</div>
		</div>
  		<a  id="sacar_del_carro" class="secondary-content"><i class="material-icons">close</i></a>
    </li>

{{ }); }}
</script>
<script id="producto-tpl" type="text/template">	
{{ _.each(productos, function(producto){  }}
	<li class="product-grid-layout animated bounceIn item last col s12 m6 l3 product-item-box">
		<div class="card z-depth-5">
			<div class="card-image">
				<img src="{{=producto.imagen}}">	
			</div>
			<div class="card-content">
				<p>{{=producto.nombre}}</p><p> $ {{=producto.precio}}</p>			
				<input  id="input_cant_pedida_{{=producto.indice}}"  maxlength="12" value="1" type="number">
				 <button id="btn_add_carro" class="btn waves-effect waves-light red">Buy<i class="material-icons right">shopping_cart</i></button>				
			</div>
		</div>		
	</li>
{{ }); }}
</script>



<script type="text/javascript">
	_.templateSettings = {
		evaluate:/\{\{(.+?)\}\}/g,
	  interpolate: /\{\{=(.+?)\}\}/g,
	  escape: /\{\{-(.+?)\}\}/g

	};
	$(document).ready(function(){

  		$('.modal').modal();
  		var carrito, ventas;
  		var productosCarroTpl = _.template($("#producto-carro-tpl").html());
		$.getJSON( "datos.json", function(datos) {
			carrito = new Carro();
			ventas = new Ventas(new ProductoFactory(datos.ProductosVentas), carrito);
			var productoTpl = _.template($("#producto-tpl").html());
			$("#productos_ventas").html(productoTpl({"productos":ventas.productos}));
		});

		function armar_html_carro() {
			var html_productos = productosCarroTpl({"productos":carrito.productos}); 
			$("#productos_carro").html(html_productos);
		}		

		$(document).on('click', '#mostrar_carro', armar_html_carro);

		$(document).on('click', '#sacar_del_carro', function(e) {
			carrito.sacarDelCarro($(this).parents('li').index());
			$(this).parents('li').remove();			
		});
		
		$(document).on('click', '#btn_add_carro', function(e) {
			var indice_prod = $(this).parents('li').index();
			var cantidad = Number($("#input_cant_pedida_"+indice_prod).val());
			ventas.agregarAlCarro(indice_prod, cantidad);
		});

		$(document).on('change', '#cant_carrito', function(e) {
			var id_prod = $(this).data("id-prod");
			carrito.actualizarCantPorId($(this).data("id-prod"), $(this).val());
			armar_html_carro();
		});
		
});
	

</script>
